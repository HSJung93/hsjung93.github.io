---
title: RFC 3744
date: 2022-04-24 21:00:00 +0900
categories: [강의, 시니어]
tags: [RFC, 3744]
---

RFC 3744: https://www.rfc-editor.org/rfc/rfc3744.html
WebDAV 접근 제어 프로토콜 문서로 current-user-privilege-set 검토
1. 권한
DAV: 현재-유저-권한-모음-읽기(read-current-user-privilege-set)
"DAV: 현재-유저-권한-모음-읽기" 권한은 리소스의 "DAV: 현재-유저-권한-모음" 프로퍼티를 추출하기 위한 PROPFINE 사용을 제어한다.
클라이언트는 이 프로퍼티를 리소스의 허용과 관련된 UI 아이템에 시각적으로 나타내기 위하여 사용한다. 예를 들어 쓸 수 없는 리소스들 회색 표시한다.
이 권한은 DAV:read-acl과는 다르다. 현재-유저-권한-모음-읽기 권한은 대부분의 사용자들의 접근을 허용할 필요가 있지만, full ACL은 현재 인증된 사용자에게 적절하지 않을 수 있다.
그 결과 full ACL을 볼 수 있는 사용자들은 현재 사용자 권한 모음을 읽을 수 있는 사용자보다 훨씬 적다. 그래서 각각의 권한이 구분되어야 한다. 
2. 권한 제어 프로퍼티
DAV: 현재-유저-권한-모음
DAV: 현재-유저-권한-셋은 현재 인증된 HTTP 사용자에게 부여된 바로 그 권한들의 모음이 담긴 보호된 프로퍼티이다. 모아진 권한들과 권한들이 포함한 권한들이 나열된다.
사용자-에이전트는 이 프로퍼티의 값을 현재 규칙 상 권한이 없는 몇몇 행동을 접근할 수 없도록 하기 위하여(메뉴 아이템이나 버튼은 회색 처리한다던가) 유저 인터페이스에 적용하여 사용할 수 있다.
이 프로퍼티는 실제로 작업을 수행하지 않고도 현재 규칙이 수행할 수 있는 작업들을 결정하는데에도 유용하다.
현재 사용자가 특정 권한을 부여 받으면, 그 권한은 이 리소스에 할당될 수 있는 권한의 모음에 속해있을 것이다. 따라서, DAV:현재-사용자-권한-모음 프로퍼티의 각 요소들은 DAV:supported-privilege-set 프로퍼티로부터의 non-abstract 권한을 식별해야만 한다. 
5.3.1. 리소스에서 지원하는 권한들의 목록을 응답하는 사례
프로퍼티: DAV:supported-privilege-set
리소스: http://www.example.com/papers/.
"[XML Namespace, localname]"을 사용해서 각 권한들을 구분하는 지원하는 권한들의 트리가 응답




   [DAV:, all] (aggregate, abstract)
      |
      +-- [DAV:, read] (aggregate)
             |
             +-- [DAV:, read-acl] (abstract)
             +-- [DAV:, read-current-user-privilege-set] (abstract)
      |
      +-- [DAV:, write] (aggregate)
             |
             +-- [DAV:, write-acl] (abstract)
             +-- [DAV:, write-properties]
             +-- [DAV:, write-content]
      |
      +-- [DAV:, unlock]




요청 예시
   PROPFIND /papers/ HTTP/1.1
   Host: www.example.com
   Content-type: text/xml; charset="utf-8"
   Content-Length: xxx
   Depth: 0
   Authorization: Digest username="gclemm",
     realm="users@example.com", nonce="...",
     uri="/papers/", response="...", opaque="..."

   <?xml version="1.0" encoding="utf-8" ?>
   <D:propfind xmlns:D="DAV:">
     <D:prop>
       <D:supported-privilege-set/>
     </D:prop>
   </D:propfind>




응답 예시
HTTP/1.1 207 Multi-Status

   Content-Type: text/xml; charset="utf-8"
   Content-Length: xxx

   <?xml version="1.0" encoding="utf-8" ?>
   <D:multistatus xmlns:D="DAV:">
     <D:response>
       <D:href>http://www.example.com/papers/</D:href>
       <D:propstat>
         <D:prop>
           <D:supported-privilege-set>
             <D:supported-privilege>
               <D:privilege><D:all/></D:privilege>
              <D:abstract/>
               <D:description xml:lang="en">
                 Any operation
               </D:description>
               <D:supported-privilege>
                 <D:privilege><D:read/></D:privilege>
                 <D:description xml:lang="en">
                   Read any object
                 </D:description>
                 <D:supported-privilege>
                   <D:privilege><D:read-acl/></D:privilege>
                   <D:abstract/>
                   <D:description xml:lang="en">Read ACL</D:description>
                 </D:supported-privilege>
                 <D:supported-privilege>
                   <D:privilege>
                     <D:read-current-user-privilege-set/>
                   </D:privilege>
                   <D:abstract/>
                   <D:description xml:lang="en">
                     Read current user privilege set property
                   </D:description>
                 </D:supported-privilege>
               </D:supported-privilege>
               <D:supported-privilege>
                 <D:privilege><D:write/></D:privilege>
                 <D:description xml:lang="en">
                   Write any object
                 </D:description>
                 <D:supported-privilege>
                   <D:privilege><D:write-acl/></D:privilege>
                   <D:description xml:lang="en">
                     Write ACL
                   </D:description>
                   <D:abstract/>
                 </D:supported-privilege>
                 <D:supported-privilege>
                   <D:privilege><D:write-properties/></D:privilege>
                   <D:description xml:lang="en">
                     Write properties
                   </D:description>
                 </D:supported-privilege>
                 <D:supported-privilege>
                   <D:privilege><D:write-content/></D:privilege>
                   <D:description xml:lang="en">
                     Write resource content
                   </D:description>
                 </D:supported-privilege>
               </D:supported-privilege>
               <D:supported-privilege>
                 <D:privilege><D:unlock/></D:privilege>
                 <D:description xml:lang="en">
                   Unlock resource
                 </D:description>
               </D:supported-privilege>
             </D:supported-privilege>
           </D:supported-privilege-set>
         </D:prop>
         <D:status>HTTP/1.1 200 OK</D:status>
       </D:propstat>
     </D:response>
   </D:multistatus>
5.4.1. 현재 유저에게 허용된 모음을 구하는 사례
프로퍼티: DAV:current-user-privilege-set
리소스: http://www.example.com/papers/
username: khare
Digest authentication 사용
DAV:read privilege 부여됨
따라서 DAV:read-acl과 DAV:현재-유저-권한-모음-읽기 권한을 포함 중
DAV:all, DAV:read-acl, DAV:write-acl, DAV:read-curretn-user-privilege-set 권한들은 abstract 권한들이기 때문에 DAV:current0suer-privilege-set의 값에 없다.
DAV:write 또한 나열되지 않는다. khare username이 쓰기 권한 규칙을 부여하는 ACE에 없기 때문이다.
요청 예시
   PROPFIND /papers/ HTTP/1.1
   Host: www.example.com
   Content-type: text/xml; charset="utf-8"
   Content-Length: xxx
   Depth: 0
   Authorization: Digest username="khare",
     realm="users@example.com", nonce="...",
     uri="/papers/", response="...", opaque="..."

   <?xml version="1.0" encoding="utf-8" ?>
   <D:propfind xmlns:D="DAV:">
     <D:prop>
       <D:current-user-privilege-set/>
     </D:prop>
   </D:propfind>




응답 예시
   HTTP/1.1 207 Multi-Status
   Content-Type: text/xml; charset="utf-8"
   Content-Length: xxx

   <?xml version="1.0" encoding="utf-8" ?>
   <D:multistatus xmlns:D="DAV:">
     <D:response>
     <D:href>http://www.example.com/papers/</D:href>
     <D:propstat>
       <D:prop>
         <D:current-user-privilege-set>
           <D:privilege><D:read/></D:privilege>
         </D:current-user-privilege-set>
       </D:prop>
       <D:status>HTTP/1.1 200 OK</D:status>
     </D:propstat>
     </D:response>
   </D:multistatus>




5.5.5 리소스의 제어 목록 접근을 응답받는 사례
프로퍼티: DAV:acl
리소스: http://www.example.com/papers/
ACE 2번: 모든 규칙들(DAV: all)은 DAV:read 권한을 부여받는다.
DAV:read가 DAV:read-acl과 DAV:read-current-user-privilege-set을 가지고 있기 때문에, 모든 사용자(maintainers 그룹의 모든 멤버들도 포함하여)들이 DAV:acl 프로퍼티와 DAV:current-user-privilege-set 프로퍼티를 읽을 수 있다는 것을 의미한다.
요청 예시
   PROPFIND /papers/ HTTP/1.1
   Host: www.example.com
   Content-type: text/xml; charset="utf-8"
   Content-Length: xxx
   Depth: 0
   Authorization: Digest username="masinter",
     realm="users@example.com", nonce="...",
     uri="/papers/", response="...", opaque="..."

   <D:propfind xmlns:D="DAV:">
     <D:prop>
       <D:acl/>
     </D:prop>
   </D:propfind>




응답 예시
   HTTP/1.1 207 Multi-Status
   Content-Type: text/xml; charset="utf-8"
   Content-Length: xxx

   <D:multistatus xmlns:D="DAV:">
     <D:response>
       <D:href>http://www.example.com/papers/</D:href>
       <D:propstat>
         <D:prop>
           <D:acl>
           <D:ace>
             <D:principal>
               <D:href
               >http://www.example.com/acl/groups/maintainers</D:href>
             </D:principal>
             <D:grant>
               <D:privilege><D:write/></D:privilege>
             </D:grant>
           </D:ace>
           <D:ace>
             <D:principal>
               <D:all/>
             </D:principal>
             <D:grant>
               <D:privilege><D:read/></D:privilege>
             </D:grant>
           </D:ace>
         </D:acl>
         </D:prop>
         <D:status>HTTP/1.1 200 OK</D:status>
       </D:propstat>
     </D:response>
   </D:multistatus>




5.9. 접근 제어 프로퍼티를 응답받기 위한 PROPFIND 사례
DAV:owner, DAV:supported-privilege-set, DAV:current-user-privilege-set, DAV:acl 프로퍼티들의 값을 fetch 받기 위한 PROPFIND 방법을 사용하여 접근 제어 정보를 응답 받는 사례.
요청 예시
   PROPFIND /top/container/ HTTP/1.1
   Host: www.example.com
   Content-type: text/xml; charset="utf-8"
   Content-Length: xxx
   Depth: 0
   Authorization: Digest username="ejw",
     realm="users@example.com", nonce="...",
     uri="/top/container/", response="...", opaque="..."

   <?xml version="1.0" encoding="utf-8" ?>
   <D:propfind xmlns:D="DAV:">
     <D:prop>
       <D:owner/>
       <D:supported-privilege-set/>
       <D:current-user-privilege-set/>
       <D:acl/>
     </D:prop>
   </D:propfind>




응답 예시
   HTTP/1.1 207 Multi-Status
   Content-Type: text/xml; charset="utf-8"
   Content-Length: xxx

   <?xml version="1.0" encoding="utf-8" ?>
   <D:multistatus xmlns:D="DAV:"
                  xmlns:A="http://www.example.com/acl/">
     <D:response>
       <D:href>http://www.example.com/top/container/</D:href>
       <D:propstat>
         <D:prop>
           <D:owner>
             <D:href>http://www.example.com/users/gclemm</D:href>
           </D:owner>
           <D:supported-privilege-set>
             <D:supported-privilege>
               <D:privilege><D:all/></D:privilege>
               <D:abstract/>
               <D:description xml:lang="en">
                 Any operation
               </D:description>
               <D:supported-privilege>
                 <D:privilege><D:read/></D:privilege>
                 <D:description xml:lang="en">
                   Read any object
                 </D:description>
               </D:supported-privilege>
               <D:supported-privilege>
                 <D:privilege><D:write/></D:privilege>
                 <D:abstract/>
                 <D:description xml:lang="en">
                   Write any object
                 </D:description>
                 <D:supported-privilege>
                   <D:privilege><A:create/></D:privilege>
                   <D:description xml:lang="en">
                     Create an object
                   </D:description>
                 </D:supported-privilege>
                 <D:supported-privilege>
                   <D:privilege><A:update/></D:privilege>
                   <D:description xml:lang="en">
                     Update an object
                   </D:description>
                 </D:supported-privilege>
               </D:supported-privilege>
               <D:supported-privilege>
                 <D:privilege><A:delete/></D:privilege>
                 <D:description xml:lang="en">
                   Delete an object
                 </D:description>
               </D:supported-privilege>
               <D:supported-privilege>
                 <D:privilege><D:read-acl/></D:privilege>
                 <D:description xml:lang="en">
                   Read the ACL
                 </D:description>
               </D:supported-privilege>
               <D:supported-privilege>
                 <D:privilege><D:write-acl/></D:privilege>
                 <D:description xml:lang="en">
                   Write the ACL
                 </D:description>
               </D:supported-privilege>
             </D:supported-privilege>
           </D:supported-privilege-set>
           <D:current-user-privilege-set>
             <D:privilege><D:read/></D:privilege>
             <D:privilege><D:read-acl/></D:privilege>
           </D:current-user-privilege-set>
           <D:acl>
             <D:ace>
               <D:principal>
                 <D:href>http://www.example.com/users/esedlar</D:href>
               </D:principal>
               <D:grant>
                 <D:privilege><D:read/></D:privilege>
                 <D:privilege><D:write/></D:privilege>
                 <D:privilege><D:read-acl/></D:privilege>
               </D:grant>
             </D:ace>
             <D:ace>
               <D:principal>
                 <D:href>http://www.example.com/groups/mrktng</D:href>
               </D:principal>
               <D:deny>
                 <D:privilege><D:read/></D:privilege>
               </D:deny>
             </D:ace>
             <D:ace>
               <D:principal>
                 <D:property><D:owner/></D:property>
               </D:principal>
               <D:grant>
                 <D:privilege><D:read-acl/></D:privilege>
                 <D:privilege><D:write-acl/></D:privilege>
               </D:grant>
             </D:ace>
             <D:ace>
               <D:principal><D:all/></D:principal>
               <D:grant>
                 <D:privilege><D:read/></D:privilege>
               </D:grant>
               <D:inherited>
                 <D:href>http://www.example.com/top</D:href>
               </D:inherited>
             </D:ace>
           </D:acl>
         </D:prop>
         <D:status>HTTP/1.1 200 OK</D:status>
       </D:propstat>
     </D:response>
   </D:multistatus>




DAV:owner 프로퍼티의 값은 하나의 DAV:href XML 요소이며 이 리소스를 가지고 있는 규칙의 URL을 가지고 있다.
DAV:supported-privilege-set 프로퍼티는 "[XML Namespace, localname]" 형식의 지원되는 권한들의 트리 값이다. 
   [DAV:, all] (aggregate, abstract)
      |
      +-- [DAV:, read]
      +-- [DAV:, write] (aggregate, abstract)
             |
             +-- [http://www.example.com/acl, create]
             +-- [http://www.example.com/acl, update]
             +-- [http://www.example.com/acl, delete]
      +-- [DAV:, read-acl]
      +-- [DAV:, write-acl]
DAV: 현재-사용자-권한-모음 프로퍼티는 DAV:read와 DAV:read-acl 2가지 권한들을 가지고 있다. 이는 현재 인증된 사용자가 리소스와 그 리소스의 DAV:acl 프로퍼티만을 읽는다는 것을 의미한다. DAV:acl 프로퍼티는 4가지가 ACE들의 모음을 가지고 있다.




12.2  DAV:read-acl과 DAV:current-user-privilege-set 권한
DAV:acl 프로퍼티에 저장된 접근 권한들을 읽거나 DAV:current-user-privilege-set 프로퍼티에 저장된 현재 인증된 사용자들에게 허용된 권한들을 읽는 능력은 문제가 있을 수 있다.
ACL 읽기는 리소스의 상태에 영향을 미칠 것으로 보이지 않지만 모든 리소스가 word-readable ACL들을 가지고 있다면, world-writable 처럼 불안한 상태에 놓여진 리소스들을 무차별적으로 찾아버릴수도 있다.
특히 PROPFIND와 같은 프로퍼티 반환 메소드는, 무한 깊이로 전체 위계를 실행되면, DAV:acl과 DAV:current-user-privilege-set 프로퍼티를 반환하는 아주 효과적인 방법이다. 이 취약점이 발견되면, 공개된 리소스가 반복적으로 다시 쓰여지는 서비스 거절 공격을 당할 수 있다.
이 위험을 줄이기 위하여, read-acl 권한은 인증되지 않은 규칙에 부여되서는 안되며, 인증된 규칙에 대한 read-acl과 read-current-user-privilege-set 권한에 대한 제한은 조심스럽게 분석되어야 한다.
current-user-privilege-set 프로퍼티에 대한 접근은 사용성과 안정성의 교환이다. current-user-privilege-set이 보여진다면, 유저 인터페이스는 허용되고 제한된 작업과 관련하여 더 좋은 정보를 제공하지만, 이 정보는 공격받을 취약점을 나타낼 수도 있다. 